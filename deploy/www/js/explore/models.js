define([],function(){var e=function(e){return Scenable.constants.SITEURL+"/api/v1/"+e},t={},n=function(e){_.isObject(e)&&(_.isNumber(e.latitude)&&_.isNumber(e.longitude)?e.geocoding={latitude:e.latitude,longitude:e.longitude}:e.geocoding=null,delete e.latitude,delete e.longitude)};t.Place=Backbone.Model.extend({urlRoot:e("place"),parse:function(e){var t=Backbone.Model.prototype.parse.call(this,e);return n(t.location),t},headerText:function(){return this.get("name")}}),t.Event=Backbone.Model.extend({urlRoot:e("event"),parse:function(e){var t=Backbone.Model.prototype.parse.call(this,e);return n(t.place&&t.place.location),t},headerText:function(){return this.get("name")}}),t.Special=Backbone.Model.extend({urlRoot:e("special"),parse:function(e){var t=Backbone.Model.prototype.parse.call(this,e);return n(t.place&&t.place.location),t.hasExpired=t.dexpires&&moment(t.dexpires)<moment(),t},headerText:function(){return this.get("title")}});var r=Backbone.Collection.extend({meta:null,query:null,categoryId:null,initialize:function(e){e&&(this.query=e.query||null,this.categoryId=e.categoryId||null,this.limit=e.limit||null,this.offset=e.offset||null,this.locationTimeout=e.locationTimeout||5e3)},fetch:function(e){e.data=e.data||{},this.categoryId!==null&&(e.data.catpk=this.categoryId),this.query!==null&&(e.data.q=this.query),this.offset!==null&&(e.data.offset=this.offset),this.limit!==null&&(e.data.limit=this.limit);var t=this;navigator.geolocation.getCurrentPosition(function(n){e.data.lat=n.coords.latitude,e.data.lng=n.coords.longitude,Backbone.Collection.prototype.fetch.call(t,e)},function(n){t.trigger("geolocationError"),Backbone.Collection.prototype.fetch.call(t,e)},{timeout:this.locationTimeout,maximumAge:15e3,enableHighAccuracy:!0})},parse:function(e){return this.meta=e.meta,e.objects},getNextPageOptions:function(){return this.meta&&this.meta.next===null?null:{offset:this.meta.offset+this.meta.limit,limit:this.meta.limit,query:this.query,categoryId:this.categoryId}},getPrevPageOptions:function(){return this.meta&&this.meta.previous===null?null:{offset:this.meta.offset-this.meta.limit,limit:this.meta.limit,query:this.query,categoryId:this.categoryId}}});return t.Places=r.extend({model:t.Place,url:e("place"),fetch:function(e){return e.data=e.data||{},e.data.listed=!0,r.prototype.fetch.call(this,e)}}),t.Events=r.extend({model:t.Event,url:e("event"),fetch:function(e){return e.data=e.data||{},e.data.listed=!0,e.data.dtend__gt=moment().format(),r.prototype.fetch.call(this,e)}}),t.Specials=r.extend({model:t.Special,url:e("special"),fetch:function(e){return e.data=e.data||{},e.data.listed=!0,e.data.dexpires__gte=moment().format("YYYY-MM-DD"),r.prototype.fetch.call(this,e)}}),t.NewsArticles=r.extend({url:e("news"),fetch:function(e){return e.data=e.data||{},this.offset!==null&&(e.data.offset=this.offset),this.limit!==null&&(e.data.limit=this.limit),Backbone.Collection.prototype.fetch.call(this,e)}}),t.PlaceCategories=Backbone.Collection.extend({url:e("place_category"),parse:function(e){return e.objects}}),t.EventCategories=Backbone.Collection.extend({url:e("event_category"),parse:function(e){return e.objects}}),t})