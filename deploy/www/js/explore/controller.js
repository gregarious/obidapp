define(["explore/models","explore/views"],function(e,t){var n=function(e,n,r){var i,s,o=null,u=null,a=null,f=function(){var e=null,t={map:null,list:null},n={};return{setFlag:function(e,t){n[e]=t},store:function(e,n){t[e]=n},retrieve:function(e){return t[e]},setActive:function(t){e=t},getActive:function(){return _.isString(e)?t[e]:e},displayActive:function(e){if(e){var t=this.getActive();t&&e.html(t.render().el)}}}}(),c=function(){f.setActive(new t.LoadingView),f.displayActive(i)},h={activate:function(e,t){i=e,this.setActiveDisplayMode(t)},deactivate:function(){i=null},setActiveDisplayMode:function(e){a=e,f.setActive(a),f.displayActive(i)},showDefaultFeed:function(){s=new e,this.updateViews()},showCategoryFiltered:function(t){s=new e({categoryId:t}),this.updateViews()},showSearchFiltered:function(t){s=new e({query:t}),this.updateViews()},showNextPage:function(){var t=s&&s.getNextPageOptions();t!==null&&(s=new e(t),this.updateViews())},showPrevPage:function(){var t=s&&s.getPrevPageOptions();t!==null&&(s=new e(t),this.updateViews())},mapNextItem:function(){},mapPrevItem:function(){},itemClicked:function(e){},updateViews:function(){c();var e=f.retrieve("list");e&&e.off();var o=n?new n({collection:s}):null;o.on("page:prev",this.showPrevPage,this),o.on("page:next",this.showNextPage,this),f.store("list",o);var u=f.retrieve("map");u&&u.off();var h=r?new r({collection:s}):null;f.store("map",h),f.setFlag("geolocationError",!1),s.off("geolocationError"),s.on("geolocationError",function(){f.setFlag("geolocationError",!0)}),s.fetch({error:function(e,n){var r=navigator.network.connection.type,i;r===Connection.NONE||r===Connection.UNKNOWN?i="No internet connection found.":i="Problem contacting server. Try again.",l=null,f.setActive(new t.ErrorView({message:i}))},complete:function(){f.displayActive(i)}}),f.setActive(a)}};return _.extend(h,Backbone.Events),h},r=function(e,t){var n=null,r=null,i=null,s={activate:function(s){i=s,n=new e,r=new t({collection:n})},deactivate:function(){i=null,n.off()},showDefaultFeed:function(){i&&i.html(r.render().el)}};return s},i={places:n(e.Places,t.PlacesList,null),events:n(e.Events,t.EventsList,null),specials:n(e.Specials,t.SpecialsList,null),news:n(e.NewsArticles,t.NewsArticleList,null),now:r(Backbone.Collection,t.NowView)},s={places:new t.CategoryFilterView({collection:new e.PlaceCategories}),events:new t.CategoryFilterView({collection:new e.EventCategories}),specials:new t.CategoryFilterView({collection:new e.PlaceCategories}),news:null,now:null},o=function(e){var t=new(Backbone.View.extend({findRegion:function(e){var t='[data-region="'+e+'"]';return this.$el.find(t)}}))({el:e});return t.$el.html('<div data-region="menu" id="header-view"></div><div id="content-view">	<div data-region="feed"></div>	<div class="push"></div></div><div data-region="filter" class="sorting"></div>'),t},u=new t.MenuView,a=null,f=null,l=null,c="list",h=function(e){if(e!==l){l=e,a&&a.deactivate(),a=i[e];if(!a){console.error('Warning: Unknown type arg "'+e+'" for ExploreController to act on.');return}a.activate();var t=k.findRegion("feed");a.activate(t,c),a.showDefaultFeed(),u.setActiveNav(l),p(s[e])}},p=function(e){f&&(f.off(),f.collection.off());var t=k.findRegion("filter");if(!e)return t.empty(),!1;e.collection.on("reset",function(){t.html(e.render().el),t.find("select").on("change",function(t){e.categorySelected(t)})}),e.collection.reset(),e.collection.fetch(),e.on("selected",function(e){m(e)}),f=e},d=function(e){c=e,u.setActiveDisplayMode(e),a&&a.setActiveDisplayMode(e)},v=function(e){a&&a.showSearchFiltered(e)},m=function(e){a&&(e<1?a.showDefaultFeed():a.showCategoryFiltered(e))},g=function(){a&&a.showNextPage()},y=function(){a&&a.showPrevPage()},b=function(e){},w=function(){},E=function(){},S=function(e,t,n,r){},x=function(){},T=function(){},N=function(){c==="map"?this.setState({displayMode:"list"}):c==="list"?this.setState({displayMode:"map"}):console.warn("Invalid activeDisplayMode: "+c)},C=function(){},k=null,L,A={activate:function(){L=$("#panel-explore"),k||(k=o(L)),L.show(),k.findRegion("menu").html(u.render().el),u.on("click:displayMode",N,this),u.on("click:searchOn",C,this)},deactivate:function(){u.off("click:displayMode"),u.off("click:displayMode"),L.hide()},setState:function(e,t){t=_.isUndefined(t)?!0:t;var n=!1;_.isUndefined(e.resourceType)||h(e.resourceType),_.isUndefined(e.displayMode)||d(e.displayMode),t&&u.render()},refreshStaticRegions:function(){k.findRegion("menu").html(u.render().el)}};return _.extend(A,Backbone.Events),A})